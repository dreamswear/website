<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créateurs - Dreamswear</title>
    <link rel="stylesheet" href="dashboard-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<script src="session-manager.js"></script>
<script src="dashboard-common.js"></script>

    <!-- Header simplifié -->
    <header class="dashboard-header">
        <div class="container">
            <div class="logo">
                <a href="index.html">DREAMS</a>
            </div>
            <div class="header-actions">
                <a href="dashboard-home.html" class="btn btn-outline" style="text-decoration: none;">
                    <i class="fas fa-home"></i> Accueil
                </a>
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-users"></i> Communauté des Créateurs</h1>
                <p class="page-subtitle">Rencontrez les talents qui font vibrer Dreamswear</p>
            </div>

            <!-- Grille des Créateurs -->
            <section class="creators-grid-section">
                <h2><i class="fas fa-star"></i> Créateurs actifs</h2>
                <div class="creators-grid" id="creatorsGrid">
                    <!-- Chargé dynamiquement -->
                    <div class="empty-state">
                        <i class="fas fa-users-slash"></i>
                        <h3>Aucun créateur pour le moment</h3>
                        <p>Les créateurs seront affichés ici</p>
                    </div>
                </div>
            </section>

            <!-- Statistiques Communauté -->
            <section class="community-stats">
                <h2><i class="fas fa-chart-bar"></i> Notre communauté en chiffres</h2>
                <div class="stats-grid">
                    <div class="stat-card large">
                        <i class="fas fa-user-friends"></i>
                        <div class="stat-content">
                            <span class="stat-number" id="totalCreators">0</span>
                            <span class="stat-label">Créateurs actifs</span>
                        </div>
                    </div>
                    
                    <div class="stat-card large">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="stat-content">
                            <span class="stat-number" id="totalCountries">0</span>
                            <span class="stat-label">Pays représentés</span>
                        </div>
                    </div>
                    
                    <div class="stat-card large">
                        <i class="fas fa-handshake"></i>
                        <div class="stat-content">
                            <span class="stat-number" id="totalCollabs">0</span>
                            <span class="stat-label">Collaborations</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Événements -->
            <section class="events-section">
                <h2><i class="fas fa-calendar-alt"></i> Prochains événements</h2>
                <div class="events-list" id="eventsList">
                    <!-- Chargé dynamiquement -->
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <h3>Aucun événement à venir</h3>
                        <p>Revenez plus tard pour découvrir nos prochains événements</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- SUPABASE SCRIPT - UNE SEULE FOIS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configuration Supabase (UNIQUEMENT ICI)
        const supabaseUrl = 'https://kfptsbpriihydidnfzhj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmcHRzYnByaWloeWRpZG5memhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNjgxODIsImV4cCI6MjA4MTY0NDE4Mn0.R4AS9kj-o3Zw0OeOTAojMeZfjPtkOZiW0jM367Fmrkk';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM chargé, Supabase initialisé:', supabase);
            
            // Gestion de la déconnexion
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                        sessionStorage.clear();
                        localStorage.clear();
                        window.location.href = 'index.html';
                    }
                });
            }

            // Charger les créateurs
            loadCreators();
            
            // Charger les événements
            loadEvents();
        });

        async function loadCreators() {
            console.log('Chargement des créateurs...');
            const grid = document.getElementById('creatorsGrid');
            if (!grid) {
                console.error('Element creatorsGrid non trouvé');
                return;
            }
            
            try {
                // Vérifier que supabase est bien défini
                if (!supabase) {
                    console.error('Supabase non initialisé');
                    return;
                }
                
                console.log('Requête Supabase pour les créateurs...');
                const { data, error } = await supabase
                    .from('creators')
                    .select('*')
                    .eq('status', 'active')
                    .eq('portfolio_complete', true)
                    .order('created_at', { ascending: false })
                    .limit(6);
                
                if (error) {
                    console.error('Erreur Supabase:', error);
                    throw error;
                }
                
                console.log('Créateurs récupérés:', data);
                
                if (!data || data.length === 0) {
                    grid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-users-slash"></i>
                            <h3>Aucun créateur pour le moment</h3>
                            <p>Les créateurs seront affichés ici</p>
                        </div>
                    `;
                    return;
                }
                
                grid.innerHTML = data.map(creator => `
                    <div class="creator-card">
                        <div class="creator-header">
                            <div class="creator-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="creator-info">
                                <h3>${creator.name || 'Créateur'}</h3>
                                <p class="creator-brand">${creator.brand_name || ''}</p>
                                <p class="creator-domain">${creator.domain || ''}</p>
                            </div>
                        </div>
                        <div class="creator-body">
                            <p>${creator.bio ? creator.bio.substring(0, 150) + '...' : 'Aucune description disponible.'}</p>
                        </div>
                    </div>
                `).join('');
                
                // Mettre à jour les statistiques
                document.getElementById('totalCreators').textContent = data.length;
                
                // Calculer les pays représentés (exemple)
                const uniqueCountries = [...new Set(data.filter(c => c.country).map(c => c.country))];
                document.getElementById('totalCountries').textContent = uniqueCountries.length;
                
            } catch (error) {
                console.error('Erreur lors du chargement des créateurs:', error);
                grid.innerHTML = `
                    <div class="empty-state error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger les créateurs. Veuillez réessayer.</p>
                    </div>
                `;
            }
        }

        async function loadEvents() {
            console.log('Chargement des événements...');
            const list = document.getElementById('eventsList');
            if (!list) {
                console.error('Element eventsList non trouvé');
                return;
            }
            
            try {
                // Vérifier que supabase est bien défini
                if (!supabase) {
                    console.error('Supabase non initialisé');
                    return;
                }
                
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                
                console.log('Requête Supabase pour les événements à partir de:', today);
                const { data, error } = await supabase
                    .from('events')
                    .select('*')
                    .gte('date', today)
                    .order('date', { ascending: true })
                    .limit(2);
                
                if (error) {
                    console.error('Erreur Supabase:', error);
                    throw error;
                }
                
                console.log('Événements récupérés:', data);
                
                if (!data || data.length === 0) {
                    list.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-times"></i>
                            <h3>Aucun événement à venir</h3>
                            <p>Revenez plus tard pour découvrir nos prochains événements</p>
                        </div>
                    `;
                    return;
                }
                
                list.innerHTML = data.map(event => {
                    const eventDate = new Date(event.date);
                    return `
                        <div class="event-card">
                            <div class="event-date">
                                <span class="event-day">${eventDate.getDate()}</span>
                                <span class="event-month">${eventDate.toLocaleDateString('fr-FR', { month: 'short' }).toUpperCase()}</span>
                            </div>
                            <div class="event-content">
                                <h3>${event.title || 'Événement sans titre'}</h3>
                                <p>${event.description ? event.description.substring(0, 100) + '...' : 'Pas de description'}</p>
                                <div class="event-meta">
                                    <span><i class="fas fa-clock"></i> ${event.time || 'Heure non définie'}</span>
                                    <span><i class="fas fa-map-marker-alt"></i> ${event.location || 'Lieu non défini'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Erreur lors du chargement des événements:', error);
                list.innerHTML = `
                    <div class="empty-state error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger les événements. Veuillez réessayer.</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
