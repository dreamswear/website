<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Témoignages - Dreamswear</title>
    <link rel="stylesheet" href="dashboard-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <script src="session-manager.js"></script>
<script src="dashboard-common.js"></script>
    <!-- Header simplifié -->
    <header class="dashboard-header">
        <div class="container">
            <div class="logo">
                <a href="index.html">DREAMS</a>
            </div>
            <div class="header-actions">
                <a href="dashboard-home.html" class="btn btn-outline" style="text-decoration: none;">
                    <i class="fas fa-home"></i> Accueil
                </a>
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-star"></i> Témoignages</h1>
                <p class="page-subtitle">Découvrez les expériences de créateurs qui ont collaboré avec Dreamswear</p>
            </div>

            <!-- Tous les témoignages -->
            <section class="all-testimonials">
                <h2><i class="fas fa-comments"></i> Témoignages de la communauté</h2>
                <div class="testimonials-grid" id="testimonialsGrid">
                    <!-- Chargé dynamiquement depuis Supabase -->
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <h3>Aucun témoignage pour le moment</h3>
                        <p>Soyez le premier à partager votre expérience !</p>
                    </div>
                </div>
            </section>

            <!-- Soumettre un témoignage -->
            <section class="submit-testimonial">
                <h2><i class="fas fa-edit"></i> Partagez votre expérience</h2>
                <div class="submit-card">
                    <div class="submit-info">
                        <h3>Votre avis compte !</h3>
                        <p>Partagez votre expérience avec Dreamswear et inspirez d'autres créateurs.</p>
                        <ul class="benefits">
                            <li><i class="fas fa-check"></i> Gagnez en visibilité</li>
                            <li><i class="fas fa-check"></i> Inspirez la communauté</li>
                            <li><i class="fas fa-check"></i> Contribuez à notre amélioration</li>
                        </ul>
                    </div>
                    <div class="submit-form">
                        <form id="testimonialForm">
                            <div class="form-group">
                                <label for="testimonialName">Votre nom *</label>
                                <input type="text" id="testimonialName" required
                                       placeholder="Votre nom ou pseudo">
                            </div>
                            <div class="form-group">
                                <label for="testimonialBrand">Nom de votre marque *</label>
                                <input type="text" id="testimonialBrand" required
                                       placeholder="Nom de votre marque ou entreprise">
                            </div>
                            <div class="form-group">
                                <label for="testimonialMessage">Votre témoignage *</label>
                                <textarea id="testimonialMessage" rows="5" required 
                                          placeholder="Partagez votre expérience avec Dreamswear..."></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> Soumettre mon témoignage
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Gestion de la déconnexion
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                        sessionStorage.clear();
                        localStorage.clear();
                        window.location.href = 'index.html';
                    }
                });
            }

            // Charger les témoignages
            loadTestimonials();

            // Soumission du témoignage
            const testimonialForm = document.getElementById('testimonialForm');
            if (testimonialForm) {
                testimonialForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('testimonialName').value.trim();
                    const brand = document.getElementById('testimonialBrand').value.trim();
                    const message = document.getElementById('testimonialMessage').value.trim();
                    
                    if (!name || !brand || !message) {
                        alert('Veuillez remplir tous les champs obligatoires');
                        return;
                    }
                    
                    try {
                        const creatorId = sessionStorage.getItem('creatorId');
                        
                        const { data, error } = await supabase
                            .from('testimonials')
                            .insert([{
                                creator_id: creatorId,
                                name: name,
                                brand: brand,
                                message: message,
                                status: 'pending',
                                created_at: new Date().toISOString()
                            }]);
                        
                        if (error) throw error;
                        
                        alert('Merci pour votre témoignage ! Il sera examiné par notre équipe avant publication.');
                        testimonialForm.reset();
                        loadTestimonials();
                        
                    } catch (error) {
                        console.error('Erreur:', error);
                        alert('Erreur lors de la soumission du témoignage');
                    }
                });
            }
        });

        async function loadTestimonials() {
            const grid = document.getElementById('testimonialsGrid');
            if (!grid) return;
            
            grid.innerHTML = '<div class="loading-state">Chargement des témoignages...</div>';
            
            try {
                const { data, error } = await supabase
                    .from('testimonials')
                    .select('*')
                    .eq('status', 'approved')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                if (data.length === 0) {
                    grid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-comments"></i>
                            <h3>Aucun témoignage pour le moment</h3>
                            <p>Soyez le premier à partager votre expérience !</p>
                        </div>
                    `;
                    return;
                }
                
                grid.innerHTML = data.map(testimonial => `
                    <div class="testimonial-card">
                        <div class="testimonial-header">
                            <div class="testimonial-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="testimonial-author">
                                <h3>${testimonial.name}</h3>
                                <p class="author-brand">${testimonial.brand}</p>
                            </div>
                        </div>
                        <div class="testimonial-content">
                            <i class="fas fa-quote-left"></i>
                            <blockquote>${testimonial.message}</blockquote>
                        </div>
                        <div class="testimonial-date">
                            <i class="fas fa-calendar"></i>
                            ${new Date(testimonial.created_at).toLocaleDateString('fr-FR')}
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Erreur:', error);
                grid.innerHTML = '<div class="error-state">Erreur lors du chargement des témoignages</div>';
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configuration Supabase
        const supabaseUrl = 'https://kfptsbpriihydidnfzhj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmcHRzYnByaWloeWRpZG5memhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNjgxODIsImV4cCI6MjA4MTY0NDE4Mn0.R4AS9kj-o3Zw0OeOTAojMeZfjPtkOZiW0jM367Fmrkk';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);
    </script>
</body>
</html>
