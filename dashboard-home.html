<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil Cr√©ateur - Dreamswear</title>
    <link rel="stylesheet" href="dashboard-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Styles pour le header simplifi√© */
        .dashboard-header {
            background: var(--dark);
            border-bottom: 1px solid var(--border);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .dashboard-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .logo a {
            color: var(--primary);
            text-decoration: none;
            letter-spacing: 1px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .btn-logout {
            padding: 8px 15px;
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-logout:hover {
            background: rgba(220, 53, 69, 0.2);
        }

        /* Styles pour la section de bienvenue */
        .welcome-avatar {
            width: 100px;
            height: 100px;
            background: var(--dark-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--primary);
            overflow: hidden;
        }

        .welcome-avatar i {
            font-size: 3.5rem;
            color: var(--primary);
            opacity: 0.7;
        }

        .creator-domain {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
            color: var(--primary);
            font-weight: 500;
        }

        .creator-domain i {
            font-size: 0.9rem;
        }

        /* Styles pour l'aper√ßu du portfolio */
        .portfolio-preview-content {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid var(--border);
        }
        
        .preview-header {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .preview-avatar {
            flex-shrink: 0;
        }
        
        .preview-info h3 {
            color: #ffffff;
            margin-bottom: 5px;
            font-size: 1.3rem;
        }
        
        .preview-creator {
            color: var(--primary);
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .preview-domain {
            color: var(--gray-light);
            font-size: 0.9rem;
        }
        
        .preview-body {
            margin-bottom: 25px;
        }
        
        .preview-body h4 {
            color: var(--primary);
            margin: 20px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }
        
        .preview-status, .preview-portfolio, .preview-contact {
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            border-radius: var(--radius);
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .status-active {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .status-incomplete {
            background: rgba(108, 117, 125, 0.1);
            color: var(--gray);
            border: 1px solid rgba(108, 117, 125, 0.3);
        }
        
        .portfolio-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            justify-content: space-between;
        }
        
        .btn-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-link:hover {
            text-decoration: underline;
        }
        
        .validation-date {
            color: var(--gray-light);
            font-size: 0.9rem;
            margin-top: 5px;
            font-style: italic;
        }
        
        .preview-contact p {
            color: #cccccc;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-contact i {
            color: var(--primary);
            width: 20px;
        }
        
        .preview-footer {
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .preview-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .validation-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--warning);
            font-size: 0.9rem;
            background: rgba(255, 193, 7, 0.1);
            padding: 10px 15px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 193, 7, 0.3);
            flex: 1;
        }
        
        .loading-state {
            text-align: center;
            padding: 40px;
            color: var(--gray-light);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(212, 175, 55, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-state {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }
        
        .error-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .empty-preview {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-light);
        }
        
        .empty-preview i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .empty-preview h3 {
            color: var(--gray-light);
            margin-bottom: 10px;
        }
        
        .empty-preview p {
            color: var(--gray);
            margin-bottom: 20px;
        }
        
        /* √âtat de chargement am√©lior√© */
        .data-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(212, 175, 55, 0.2);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-text {
            color: var(--gray-light);
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .preview-header {
                flex-direction: column;
                text-align: center;
            }
            
            .preview-actions {
                flex-direction: column;
            }
        }
    </style>
    
    <!-- Ajoutez ce script en premier dans dashboard-home.html -->
</head>
<body>
    <script src="session-manager.js"></script>
    <script src="dashboard-common.js"></script>
    <!-- Header simplifi√© -->
    <header class="dashboard-header">
        <div class="container">
            <div class="logo">
                <a href="index.html">DREAMS</a>
            </div>
            <div class="header-actions">
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> D√©connexion
                </button>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-user-circle"></i> Mon Espace Cr√©ateur</h1>
                <p class="page-subtitle">G√©rez votre marque et d√©veloppez votre visibilit√©</p>
            </div>

            <!-- Section Bienvenue -->
            <section class="welcome-section">
                <div class="welcome-header">
                    <div class="welcome-avatar" id="welcomeAvatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="welcome-text">
                        <h1 id="welcomeTitle">Bonjour, <span id="creatorName" class="loading-text">Chargement...</span> !</h1>
                        <p class="welcome-subtitle" id="welcomeSubtitle">
                            Votre espace personnel pour faire grandir votre marque
                        </p>
                        <div class="creator-domain" id="creatorDomain">
                            <i class="fas fa-tag"></i>
                            <span id="domainText" class="loading-text">Chargement...</span>
                        </div>
                    </div>
                </div>

                <div class="quick-stats">
                    <div class="stat-card">
                        <i class="fas fa-calendar-check"></i>
                        <div>
                            <span class="stat-number" id="memberDays">0</span>
                            <span class="stat-label">jours avec nous</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-chart-line"></i>
                        <div>
                            <span class="stat-number" id="portfolioCompletion">0%</span>
                            <span class="stat-label">portfolio compl√©t√©</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-eye"></i>
                        <div>
                            <span class="stat-number" id="profileViews">0</span>
                            <span class="stat-label">vues du profil</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Navigation Rapide -->
            <section class="quick-nav-section">
                <h2><i class="fas fa-compass"></i> Explorez votre espace</h2>
                <div class="quick-nav-grid">
                    <a href="dashboard-portfolio.html" class="nav-card">
                        <div class="nav-icon" style="background: #4CAF50;">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <h3>Mon Portfolio</h3>
                        <p>Personnalisez votre pr√©sentation</p>
                    </a>
                    
                    <a href="dashboard-interactions.html" class="nav-card">
                        <div class="nav-icon" style="background: #2196F3;">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3>Interactions</h3>
                        <p>Contactez l'√©quipe Dreamswear</p>
                    </a>
                    
                    <a href="dashboard-creators.html" class="nav-card">
                        <div class="nav-icon" style="background: #9C27B0;">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Cr√©ateurs</h3>
                        <p>D√©couvrez la communaut√©</p>
                    </a>
                    
                    <a href="dashboard-opportunities.html" class="nav-card">
                        <div class="nav-icon" style="background: #FF9800;">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <h3>Opportunit√©s</h3>
                        <p>Participez aux projets</p>
                    </a>
                    
                    <!-- NOUVEAUX LIENS AJOUT√âS -->
                    <a href="dashboard-annuaire.html" class="nav-card">
                        <div class="nav-icon" style="background: #d4af37;">
                            <i class="fas fa-address-book"></i>
                        </div>
                        <h3>Annuaire</h3>
                        <p>Trouvez des professionnels</p>
                    </a>
                    
                    <a href="dashboard-temoignages.html" class="nav-card">
                        <div class="nav-icon" style="background: #e91e63;">
                            <i class="fas fa-star"></i>
                        </div>
                        <h3>T√©moignages</h3>
                        <p>Lisez les exp√©riences</p>
                    </a>
                    
                    <!-- ESPACE √âDUCATIF AJOUT√â -->
                    <a href="dashboard-espace-educatif.html" class="nav-card">
                        <div class="nav-icon" style="background: #17a2b8;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h3>Espace √âducatif</h3>
                        <p>Ressources et conseils mode</p>
                    </a>
                </div>
            </section>

            <!-- Aper√ßu du Portfolio -->
            <section class="portfolio-preview-section">
                <div class="section-header">
                    <h2><i class="fas fa-eye"></i> Aper√ßu de votre portfolio</h2>
                    <a href="dashboard-portfolio.html" class="edit-btn">
                        <i class="fas fa-edit"></i> Modifier
                    </a>
                </div>
                
                <div class="preview-container" id="portfolioPreview">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Chargement de votre portfolio...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configuration Supabase
        const supabaseUrl = 'https://kfptsbpriihydidnfzhj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmcHRzYnByaWloeWRpZG5memhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNjgxODIsImV4cCI6MjA4MTY0NDE4Mn0.R4AS9kj-o3Zw0OeOTAojMeZfjPtkOZiW0jM367Fmrkk';
        let supabase;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üè† Dashboard Home charg√©');
            
            // Initialiser Supabase
            initSupabase();
            
            // V√©rifier la connexion
            if (!SessionManager.isCreatorLoggedIn()) {
                console.warn('üö´ Cr√©ateur non connect√©, redirection...');
                alert('Veuillez vous connecter pour acc√©der √† cette page.');
                window.location.href = 'index.html';
                return;
            }
            
            // Gestion de la d√©connexion
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                        SessionManager.logout();
                        window.location.href = 'index.html';
                    }
                });
            }
            
            // AFFICHER IMM√âDIATEMENT LES DONN√âES DU CR√âATEUR
            displayCreatorDataImmediately();
            
            // CHARGER LES DONN√âES COMPL√àTES DEPUIS SUPABASE
            loadCreatorDataFromSupabase();
        });

        function initSupabase() {
            if (supabaseUrl && supabaseKey) {
                supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                console.log('‚úÖ Supabase initialis√©');
            }
        }

        // Afficher les donn√©es imm√©diatement depuis la session
        function displayCreatorDataImmediately() {
            // R√©cup√©rer les donn√©es via SessionManager
            const creatorData = SessionManager.getCreatorData();
            
            console.log('üé® Donn√©es du cr√©ateur:', creatorData);
            
            // Afficher le nom
            const creatorNameElement = document.getElementById('creatorName');
            if (creatorNameElement) {
                creatorNameElement.textContent = creatorData.name;
            }
            
            // Afficher le domaine
            const domainTextElement = document.getElementById('domainText');
            if (domainTextElement) {
                domainTextElement.textContent = creatorData.domain;
            }
            
            // Afficher les initiales dans l'avatar
            displayInitials(creatorData.name);
            
            // Mettre √† jour le sous-titre selon le domaine
            updateWelcomeSubtitle(creatorData.domain);
        }

        // Fonction pour afficher les initiales
        function displayInitials(fullName) {
            const avatarElement = document.getElementById('welcomeAvatar');
            if (!avatarElement) return;
            
            let initials = '';
            if (fullName && fullName.trim() !== '') {
                initials = fullName
                    .split(' ')
                    .filter(name => name.trim() !== '')
                    .map(name => name.charAt(0).toUpperCase())
                    .join('');
            }
            
            if (initials.length > 0) {
                avatarElement.innerHTML = `
                    <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;
                          font-size:2.5rem;font-weight:bold;color:var(--primary);">
                        ${initials}
                    </div>
                `;
            } else {
                avatarElement.innerHTML = '<i class="fas fa-user-circle"></i>';
            }
        }

        // Fonction pour mettre √† jour le sous-titre
        function updateWelcomeSubtitle(domain) {
            const subtitle = document.getElementById('welcomeSubtitle');
            if (!subtitle) return;
            
            const domainTitles = {
                'Styliste haute couture': 'Votre espace pour cr√©er des pi√®ces uniques',
                'Styliste streetwear': 'Exprimez votre style streetwear',
                'Designer': 'D√©veloppez votre vision cr√©ative',
                'Marque de bijoux': 'Faites briller vos cr√©ations',
                'Artisans du tricot': 'Tissez votre succ√®s cr√©atif'
            };
            
            subtitle.textContent = domainTitles[domain] || 
                'Votre espace personnel pour faire grandir votre marque';
        }

        // Charger les donn√©es compl√®tes depuis Supabase
        async function loadCreatorDataFromSupabase() {
            try {
                const creatorData = SessionManager.getCreatorData();
                const creatorId = creatorData.id;
                
                if (!creatorId) {
                    console.warn('‚ùå ID cr√©ateur non trouv√©');
                    return;
                }

                console.log('üîÑ Chargement des donn√©es depuis Supabase pour:', creatorId);

                // R√©cup√©rer les donn√©es du cr√©ateur
                const { data, error } = await supabase
                    .from('cr√©ateurs')
                    .select('*')
                    .eq('id', creatorId)
                    .single();

                if (error) {
                    console.error('‚ùå Erreur Supabase:', error);
                    return;
                }

                if (data) {
                    console.log('‚úÖ Donn√©es r√©cup√©r√©es:', data);
                    
                    // Mettre √† jour la session avec toutes les donn√©es
                    SessionManager.saveCreatorSession(data);
                    
                    // Calculer les jours depuis l'inscription
                    if (data.date_inscription) {
                        const joinDate = new Date(data.date_inscription);
                        const now = new Date();
                        const days = Math.floor((now - joinDate) / (1000 * 60 * 60 * 24));
                        const daysElement = document.getElementById('memberDays');
                        if (daysElement) {
                            daysElement.textContent = days;
                        }
                    }
                    
                    // Charger l'aper√ßu du portfolio
                    loadPortfolioPreview(data);
                }

            } catch (error) {
                console.error('üí• Erreur chargement donn√©es:', error);
            }
        }

        // Fonction pour charger l'aper√ßu du portfolio
        async function loadPortfolioPreview(creatorData) {
            const previewContainer = document.getElementById('portfolioPreview');
            if (!previewContainer) return;

            try {
                const creatorId = SessionManager.getCreatorData().id;
                
                if (!creatorId) {
                    previewContainer.innerHTML = `
                        <div class="empty-preview">
                            <i class="fas fa-portrait"></i>
                            <h3>Connectez-vous pour voir votre portfolio</h3>
                            <a href="index.html" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt"></i> Se connecter
                            </a>
                        </div>
                    `;
                    return;
                }

                // V√©rifier si le cr√©ateur a un portfolio
                const { data: portfolioData, error: portfolioError } = await supabase
                    .from('portfolio')
                    .select('*')
                    .eq('creator_id', creatorId)
                    .single();

                const hasPortfolio = portfolioData && !portfolioError;

                // Afficher l'aper√ßu
                previewContainer.innerHTML = `
                    <div class="portfolio-preview-content">
                        <div class="preview-header">
                            <div class="preview-avatar">
                                <div style="width:80px;height:80px;background:var(--dark);border-radius:50%;
                                      display:flex;align-items:center;justify-content:center;
                                      color:var(--primary);font-size:2rem;font-weight:bold;
                                      border:3px solid var(--primary);">
                                    ${creatorData.prenom ? creatorData.prenom.charAt(0).toUpperCase() : ''}${creatorData.nom ? creatorData.nom.charAt(0).toUpperCase() : ''}
                                </div>
                            </div>
                            <div class="preview-info">
                                <h3>${creatorData.nom_marque || 'Votre marque'}</h3>
                                <p class="preview-creator">${creatorData.prenom} ${creatorData.nom}</p>
                                <p class="preview-domain">${creatorData.domaine || 'Domaine non sp√©cifi√©'}</p>
                            </div>
                        </div>
                        
                        <div class="preview-body">
                            <div class="preview-status">
                                <h4><i class="fas fa-chart-line"></i> Statut de votre compte</h4>
                                <div class="status-indicator ${creatorData.statut === 'validated' ? 'status-active' : 'status-pending'}">
                                    <i class="fas fa-${creatorData.statut === 'validated' ? 'check-circle' : 'clock'}"></i>
                                    <span>${creatorData.statut === 'validated' ? 'Compte valid√©' : 'En attente de validation'}</span>
                                </div>
                                ${creatorData.statut === 'validated' && creatorData.date_validation ? 
                                    `<p class="validation-date">Valid√© le ${new Date(creatorData.date_validation).toLocaleDateString('fr-FR')}</p>` : ''}
                            </div>
                            
                            <div class="preview-portfolio">
                                <h4><i class="fas fa-file-alt"></i> Portfolio</h4>
                                ${hasPortfolio ? 
                                    `<div class="portfolio-status status-active">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Portfolio complet</span>
                                        <a href="dashboard-portfolio.html" class="btn-link">Voir</a>
                                    </div>` :
                                    `<div class="portfolio-status status-incomplete">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span>Portfolio incomplet</span>
                                        <a href="dashboard-portfolio.html" class="btn-link">Compl√©ter</a>
                                    </div>`}
                            </div>
                            
                            <div class="preview-contact">
                                <h4><i class="fas fa-envelope"></i> Contact</h4>
                                <p><i class="fas fa-envelope"></i> ${creatorData.email}</p>
                                ${creatorData.telephone ? `<p><i class="fas fa-phone"></i> ${creatorData.telephone}</p>` : ''}
                                ${creatorData.date_inscription ? `<p><i class="fas fa-calendar"></i> Membre depuis ${new Date(creatorData.date_inscription).toLocaleDateString('fr-FR')}</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="preview-footer">
                            <div class="preview-actions">
                                <a href="dashboard-portfolio.html" class="btn btn-outline">
                                    <i class="fas fa-edit"></i> Modifier mon portfolio
                                </a>
                                ${creatorData.statut !== 'validated' ? 
                                    `<div class="validation-info">
                                        <i class="fas fa-info-circle"></i>
                                        <span>Votre compte est en attente de validation par notre √©quipe</span>
                                    </div>` : ''}
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('Erreur lors du chargement du portfolio:', error);
                previewContainer.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger votre portfolio</p>
                        <button onclick="retryLoading()" class="btn btn-primary">
                            <i class="fas fa-redo"></i> R√©essayer
                        </button>
                    </div>
                `;
            }
        }

        // Fonction pour r√©essayer le chargement
        function retryLoading() {
            document.getElementById('creatorName').textContent = 'Chargement...';
            document.getElementById('creatorName').classList.add('loading-text');
            document.getElementById('domainText').textContent = 'Chargement...';
            document.getElementById('domainText').classList.add('loading-text');
            
            loadCreatorDataFromSupabase();
        }
    </script>
</body>
</html>
