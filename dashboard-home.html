<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil Créateur - Dreamswear</title>
    <link rel="stylesheet" href="dashboard-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Styles pour le header simplifié */
        .dashboard-header {
            background: var(--dark);
            border-bottom: 1px solid var(--border);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .dashboard-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .logo a {
            color: var(--primary);
            text-decoration: none;
            letter-spacing: 1px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .btn-logout {
            padding: 8px 15px;
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-logout:hover {
            background: rgba(220, 53, 69, 0.2);
        }

        /* Styles pour la section de bienvenue */
        .welcome-avatar {
            width: 100px;
            height: 100px;
            background: var(--dark-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--primary);
            overflow: hidden;
        }

        .welcome-avatar i {
            font-size: 3.5rem;
            color: var(--primary);
            opacity: 0.7;
        }

        .creator-domain {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
            color: var(--primary);
            font-weight: 500;
        }

        .creator-domain i {
            font-size: 0.9rem;
        }

        /* Styles pour l'aperçu du portfolio */
        .portfolio-preview-content {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid var(--border);
        }
        
        .preview-header {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .preview-avatar {
            flex-shrink: 0;
        }
        
        .preview-info h3 {
            color: #ffffff;
            margin-bottom: 5px;
            font-size: 1.3rem;
        }
        
        .preview-creator {
            color: var(--primary);
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .preview-domain {
            color: var(--gray-light);
            font-size: 0.9rem;
        }
        
        .preview-body {
            margin-bottom: 25px;
        }
        
        .preview-body h4 {
            color: var(--primary);
            margin: 20px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }
        
        .preview-status, .preview-portfolio, .preview-contact {
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            border-radius: var(--radius);
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .status-active {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .status-incomplete {
            background: rgba(108, 117, 125, 0.1);
            color: var(--gray);
            border: 1px solid rgba(108, 117, 125, 0.3);
        }
        
        .portfolio-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            justify-content: space-between;
        }
        
        .btn-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-link:hover {
            text-decoration: underline;
        }
        
        .validation-date {
            color: var(--gray-light);
            font-size: 0.9rem;
            margin-top: 5px;
            font-style: italic;
        }
        
        .preview-contact p {
            color: #cccccc;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-contact i {
            color: var(--primary);
            width: 20px;
        }
        
        .preview-footer {
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .preview-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .validation-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--warning);
            font-size: 0.9rem;
            background: rgba(255, 193, 7, 0.1);
            padding: 10px 15px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 193, 7, 0.3);
            flex: 1;
        }
        
        .loading-state {
            text-align: center;
            padding: 40px;
            color: var(--gray-light);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(212, 175, 55, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-state {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }
        
        .error-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .empty-preview {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-light);
        }
        
        .empty-preview i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .empty-preview h3 {
            color: var(--gray-light);
            margin-bottom: 10px;
        }
        
        .empty-preview p {
            color: var(--gray);
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .preview-header {
                flex-direction: column;
                text-align: center;
            }
            
            .preview-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header simplifié -->
    <header class="dashboard-header">
        <div class="container">
            <div class="logo">
                <a href="index.html">DREAMS</a>
            </div>
            <div class="header-actions">
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-user-circle"></i> Mon Espace Créateur</h1>
                <p class="page-subtitle">Gérez votre marque et développez votre visibilité</p>
            </div>

            <!-- Section Bienvenue -->
            <section class="welcome-section">
                <div class="welcome-header">
                    <div class="welcome-avatar" id="welcomeAvatar">
                        <!-- Les initiales seront affichées immédiatement -->
                    </div>
                    <div class="welcome-text">
                        <h1>Bonjour, <span id="creatorName"></span> !</h1>
                        <p class="welcome-subtitle" id="welcomeSubtitle">
                            <!-- Le sous-titre sera mis à jour dynamiquement -->
                        </p>
                        <div class="creator-domain" id="creatorDomain">
                            <i class="fas fa-tag"></i>
                            <span id="domainText"></span>
                        </div>
                    </div>
                </div>

                <div class="quick-stats">
                    <div class="stat-card">
                        <i class="fas fa-calendar-check"></i>
                        <div>
                            <span class="stat-number" id="memberDays">0</span>
                            <span class="stat-label">jours avec nous</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-chart-line"></i>
                        <div>
                            <span class="stat-number" id="portfolioCompletion">0%</span>
                            <span class="stat-label">portfolio complété</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-eye"></i>
                        <div>
                            <span class="stat-number" id="profileViews">0</span>
                            <span class="stat-label">vues du profil</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Navigation Rapide MODIFIÉE -->
            <section class="quick-nav-section">
                <h2><i class="fas fa-compass"></i> Explorez votre espace</h2>
                <div class="quick-nav-grid">
                    <a href="dashboard-portfolio.html" class="nav-card">
                        <div class="nav-icon" style="background: #4CAF50;">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <h3>Mon Portfolio</h3>
                        <p>Personnalisez votre présentation</p>
                    </a>
                    
                    <a href="dashboard-interactions.html" class="nav-card">
                        <div class="nav-icon" style="background: #2196F3;">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3>Interactions</h3>
                        <p>Contactez l'équipe Dreamswear</p>
                    </a>
                    
                    <a href="dashboard-creators.html" class="nav-card">
                        <div class="nav-icon" style="background: #9C27B0;">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Créateurs</h3>
                        <p>Découvrez la communauté</p>
                    </a>
                    
                    <a href="dashboard-opportunities.html" class="nav-card">
                        <div class="nav-icon" style="background: #FF9800;">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <h3>Opportunités</h3>
                        <p>Participez aux projets</p>
                    </a>
                    
                    <!-- NOUVEAUX LIENS AJOUTÉS -->
                    <a href="dashboard-annuaire.html" class="nav-card">
                        <div class="nav-icon" style="background: #d4af37;">
                            <i class="fas fa-address-book"></i>
                        </div>
                        <h3>Annuaire</h3>
                        <p>Trouvez des professionnels</p>
                    </a>
                    
                    <a href="dashboard-temoignages.html" class="nav-card">
                        <div class="nav-icon" style="background: #e91e63;">
                            <i class="fas fa-star"></i>
                        </div>
                        <h3>Témoignages</h3>
                        <p>Lisez les expériences</p>
                    </a>
                </div>
            </section>

            <!-- Aperçu du Portfolio -->
            <section class="portfolio-preview-section">
                <div class="section-header">
                    <h2><i class="fas fa-eye"></i> Aperçu de votre portfolio</h2>
                    <a href="dashboard-portfolio.html" class="edit-btn">
                        <i class="fas fa-edit"></i> Modifier
                    </a>
                </div>
                
                <div class="preview-container" id="portfolioPreview">
                    <!-- Chargé dynamiquement depuis Supabase -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Chargement de votre portfolio...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configuration Supabase
        const supabaseUrl = 'https://kfptsbpriihydidnfzhj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmcHRzYnByaWloeWRpZG5memhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNjgxODIsImV4cCI6MjA4MTY0NDE4Mn0.R4AS9kj-o3Zw0OeOTAojMeZfjPtkOZiW0jM367Fmrkk';
        let supabase;

        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser Supabase
            initSupabase();
            
            // Gestion de la déconnexion
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                        sessionStorage.clear();
                        localStorage.clear();
                        window.location.href = 'index.html';
                    }
                });
            }

            // AFFICHER IMMÉDIATEMENT LES DONNÉES DU CRÉATEUR
            displayCreatorDataImmediately();
            
            // Charger les données supplémentaires depuis Supabase
            loadCreatorData();
            loadPortfolioPreview();
        });

        function initSupabase() {
            if (supabaseUrl && supabaseKey) {
                supabase = supabase.createClient(supabaseUrl, supabaseKey);
            } else {
                console.error('Configuration Supabase manquante');
                alert('Erreur de configuration. Veuillez contacter l\'administrateur.');
            }
        }

        // NOUVELLE FONCTION : Afficher les données immédiatement
        function displayCreatorDataImmediately() {
            // Récupérer les données du créateur depuis sessionStorage
            const creatorName = sessionStorage.getItem('creatorName') || localStorage.getItem('creatorName');
            const creatorDomain = sessionStorage.getItem('creatorDomain') || localStorage.getItem('creatorDomain');
            
            // Afficher le nom immédiatement
            const creatorNameElement = document.getElementById('creatorName');
            if (creatorName) {
                creatorNameElement.textContent = creatorName;
            } else {
                creatorNameElement.textContent = 'Créateur';
            }
            
            // Afficher le domaine immédiatement
            const domainTextElement = document.getElementById('domainText');
            if (creatorDomain) {
                domainTextElement.textContent = creatorDomain;
            } else {
                domainTextElement.textContent = 'Domaine non spécifié';
            }
            
            // Afficher les initiales dans l'avatar
            displayInitials(creatorName || '');
            
            // Mettre à jour le sous-titre selon le domaine
            updateWelcomeSubtitle(creatorDomain || '');
        }

        // Fonction pour afficher les initiales
        function displayInitials(fullName) {
            const avatarElement = document.getElementById('welcomeAvatar');
            if (!avatarElement) return;
            
            // Extraire les initiales
            let initials = '';
            if (fullName && fullName.trim() !== '') {
                initials = fullName
                    .split(' ')
                    .filter(name => name.trim() !== '')
                    .map(name => name.charAt(0).toUpperCase())
                    .join('');
            }
            
            if (initials.length > 0) {
                avatarElement.innerHTML = `
                    <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;
                          font-size:2.5rem;font-weight:bold;color:var(--primary);">
                        ${initials}
                    </div>
                `;
            } else {
                avatarElement.innerHTML = '<i class="fas fa-user-circle"></i>';
            }
        }

        // Fonction pour mettre à jour le sous-titre de bienvenue
        function updateWelcomeSubtitle(domain) {
            const subtitle = document.getElementById('welcomeSubtitle');
            if (!subtitle) return;
            
            const domainTitles = {
                'Styliste haute couture': 'Votre espace pour créer des pièces uniques',
                'Styliste streetwear': 'Exprimez votre style streetwear',
                'Designer': 'Développez votre vision créative',
                'Marque de bijoux': 'Faites briller vos créations',
                'Artisans du tricot': 'Tissez votre succès créatif'
            };
            
            subtitle.textContent = domainTitles[domain] || 
                'Votre espace personnel pour faire grandir votre marque';
        }

        async function loadCreatorData() {
            try {
                // Récupérer l'ID du créateur depuis la session
                const creatorId = sessionStorage.getItem('creatorId') || localStorage.getItem('creatorId');
                
                if (!creatorId) {
                    console.warn('Aucun ID de créateur trouvé');
                    return;
                }

                // Récupérer les données du créateur depuis Supabase
                const { data, error } = await supabase
                    .from('créateurs')
                    .select('*')
                    .eq('id', creatorId)
                    .single();

                if (error) {
                    console.error('Erreur Supabase:', error);
                    return;
                }

                if (data) {
                    // Mettre à jour les données dans sessionStorage
                    const fullName = `${data.prenom} ${data.nom}`;
                    sessionStorage.setItem('creatorName', fullName);
                    sessionStorage.setItem('creatorDomain', data.domaine || 'Domaine non spécifié');
                    sessionStorage.setItem('creatorBrand', data.nom_marque || '');
                    sessionStorage.setItem('creatorEmail', data.email);
                    sessionStorage.setItem('creatorStatus', data.statut || 'pending');
                    
                    // Calculer les jours depuis l'inscription
                    if (data.date_inscription) {
                        const joinDate = new Date(data.date_inscription);
                        const now = new Date();
                        const days = Math.floor((now - joinDate) / (1000 * 60 * 60 * 24));
                        document.getElementById('memberDays').textContent = days;
                    }
                    
                    // Mettre à jour le sous-titre selon le domaine
                    updateWelcomeSubtitle(data.domaine || '');
                    
                }

            } catch (error) {
                console.error('Erreur lors du chargement des données:', error);
            }
        }

        async function loadPortfolioPreview() {
            const previewContainer = document.getElementById('portfolioPreview');
            if (!previewContainer) return;

            try {
                const creatorId = sessionStorage.getItem('creatorId') || localStorage.getItem('creatorId');
                
                if (!creatorId) {
                    previewContainer.innerHTML = `
                        <div class="empty-preview">
                            <i class="fas fa-portrait"></i>
                            <h3>Connectez-vous pour voir votre portfolio</h3>
                            <a href="index.html" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt"></i> Se connecter
                            </a>
                        </div>
                    `;
                    return;
                }

                // Récupérer les données du créateur depuis Supabase
                const { data, error } = await supabase
                    .from('créateurs')
                    .select('*')
                    .eq('id', creatorId)
                    .single();

                if (error || !data) {
                    previewContainer.innerHTML = `
                        <div class="empty-preview">
                            <i class="fas fa-portrait"></i>
                            <h3>Votre portfolio est vide</h3>
                            <p>Complétez-le pour être visible par la communauté</p>
                            <a href="dashboard-portfolio.html" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i> Créer mon portfolio
                            </a>
                        </div>
                    `;
                    return;
                }

                // Vérifier si le créateur a un portfolio dans la table "portfolio"
                const { data: portfolioData, error: portfolioError } = await supabase
                    .from('portfolio')
                    .select('*')
                    .eq('creator_id', creatorId)
                    .single();

                const hasPortfolio = portfolioData && !portfolioError;

                // Afficher l'aperçu du portfolio
                previewContainer.innerHTML = `
                    <div class="portfolio-preview-content">
                        <div class="preview-header">
                            <div class="preview-avatar">
                                <div style="width:80px;height:80px;background:var(--dark);border-radius:50%;
                                      display:flex;align-items:center;justify-content:center;
                                      color:var(--primary);font-size:2rem;font-weight:bold;
                                      border:3px solid var(--primary);">
                                    ${data.prenom ? data.prenom.charAt(0).toUpperCase() : ''}${data.nom ? data.nom.charAt(0).toUpperCase() : ''}
                                </div>
                            </div>
                            <div class="preview-info">
                                <h3>${data.nom_marque || 'Votre marque'}</h3>
                                <p class="preview-creator">${data.prenom} ${data.nom}</p>
                                <p class="preview-domain">${data.domaine || 'Domaine non spécifié'}</p>
                            </div>
                        </div>
                        
                        <div class="preview-body">
                            <div class="preview-status">
                                <h4><i class="fas fa-chart-line"></i> Statut de votre compte</h4>
                                <div class="status-indicator ${data.statut === 'validated' ? 'status-active' : 'status-pending'}">
                                    <i class="fas fa-${data.statut === 'validated' ? 'check-circle' : 'clock'}"></i>
                                    <span>${data.statut === 'validated' ? 'Compte validé' : 'En attente de validation'}</span>
                                </div>
                                ${data.statut === 'validated' && data.date_validation ? 
                                    `<p class="validation-date">Validé le ${new Date(data.date_validation).toLocaleDateString('fr-FR')}</p>` : ''}
                            </div>
                            
                            <div class="preview-portfolio">
                                <h4><i class="fas fa-file-alt"></i> Portfolio</h4>
                                ${hasPortfolio ? 
                                    `<div class="portfolio-status status-active">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Portfolio complet</span>
                                        <a href="dashboard-portfolio.html" class="btn-link">Voir</a>
                                    </div>` :
                                    `<div class="portfolio-status status-incomplete">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span>Portfolio incomplet</span>
                                        <a href="dashboard-portfolio.html" class="btn-link">Compléter</a>
                                    </div>`}
                            </div>
                            
                            <div class="preview-contact">
                                <h4><i class="fas fa-envelope"></i> Contact</h4>
                                <p><i class="fas fa-envelope"></i> ${data.email}</p>
                                ${data.telephone ? `<p><i class="fas fa-phone"></i> ${data.telephone}</p>` : ''}
                                <p><i class="fas fa-calendar"></i> Membre depuis ${new Date(data.date_inscription).toLocaleDateString('fr-FR')}</p>
                            </div>
                        </div>
                        
                        <div class="preview-footer">
                            <div class="preview-actions">
                                <a href="dashboard-portfolio.html" class="btn btn-outline">
                                    <i class="fas fa-edit"></i> Modifier mon portfolio
                                </a>
                                ${data.statut !== 'validated' ? 
                                    `<div class="validation-info">
                                        <i class="fas fa-info-circle"></i>
                                        <span>Votre compte est en attente de validation par notre équipe</span>
                                    </div>` : ''}
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('Erreur lors du chargement du portfolio:', error);
                previewContainer.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger votre portfolio</p>
                        <a href="dashboard-portfolio.html" class="btn btn-primary">
                            <i class="fas fa-redo"></i> Réessayer
                        </a>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
