<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Espace √âducatif - Dreamswear Admin</title>
    <link rel="stylesheet" href="dashboard-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Styles sp√©cifiques pour la gestion de l'espace √©ducatif */
        .management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .article-management-card {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .article-management-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }
        
        .article-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .status-published {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        .status-draft {
            background: rgba(108, 117, 125, 0.2);
            color: var(--gray);
            border: 1px solid rgba(108, 117, 125, 0.3);
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .article-title {
            color: #ffffff;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .article-category {
            display: inline-block;
            background: var(--dark);
            color: var(--primary);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-bottom: 15px;
        }
        
        .article-excerpt {
            color: var(--gray-light);
            margin-bottom: 20px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .article-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .article-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .empty-articles {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
            grid-column: 1 / -1;
        }
        
        .empty-articles i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray-light);
            font-size: 0.9rem;
        }
        
        .filter-bar {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: 500;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: #ffffff;
        }
        
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 10px 20px;
            background: var(--dark-light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--gray-light);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category-tab:hover,
        .category-tab.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
        }
        
        .modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .loading-state {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            grid-column: 1 / -1;
        }
        
        .loading-spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .articles-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-bar {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>

    <!-- Header simplifi√© -->
    <header class="dashboard-header">
        <div class="container">
            <div class="logo">
                <a href="admin.html">DREAMS ADMIN</a>
            </div>
            <div class="header-actions">
                <a href="dashboard-management.html" class="btn btn-outline" style="text-decoration: none;">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> D√©connexion
                </button>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-graduation-cap"></i> Gestion de l'Espace √âducatif</h1>
                <p class="page-subtitle">Cr√©ez et g√©rez les articles √©ducatifs pour les cr√©ateurs</p>
            </div>

            <!-- Statistiques -->
            <div class="stats-cards">
                <div class="stat-card">
                    <span class="stat-number" id="totalArticlesCount">0</span>
                    <span class="stat-label">Articles total</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="publishedArticlesCount">0</span>
                    <span class="stat-label">Articles publi√©s</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="draftArticlesCount">0</span>
                    <span class="stat-label">Brouillons</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalViewsCount">0</span>
                    <span class="stat-label">Vues totales</span>
                </div>
            </div>

            <!-- Barre de filtres -->
            <div class="filter-bar">
                <div class="filter-group">
                    <label for="searchArticles"><i class="fas fa-search"></i> Rechercher</label>
                    <input type="text" id="searchArticles" placeholder="Rechercher un article...">
                </div>
                <div class="filter-group">
                    <label for="filterCategory"><i class="fas fa-filter"></i> Cat√©gorie</label>
                    <select id="filterCategory">
                        <option value="">Toutes les cat√©gories</option>
                        <option value="√âducation mode & industrie">√âducation mode & industrie</option>
                        <option value="√âducation pour cr√©ateurs & marques">√âducation pour cr√©ateurs & marques</option>
                        <option value="Culture & histoire de la mode">Culture & histoire de la mode</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterStatus"><i class="fas fa-circle"></i> Statut</label>
                    <select id="filterStatus">
                        <option value="">Tous les statuts</option>
                        <option value="published">Publi√©</option>
                        <option value="draft">Brouillon</option>
                        <option value="pending">En attente</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button id="clearFilters" class="btn btn-outline" style="width: 100%;">
                        <i class="fas fa-times"></i> Effacer les filtres
                    </button>
                </div>
            </div>

            <!-- En-t√™te avec actions -->
            <div class="management-header">
                <h2><i class="fas fa-newspaper"></i> Articles √âducatifs</h2>
                <div class="header-actions">
                    <button id="addArticleBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Nouvel article
                    </button>
                    <button id="refreshArticles" class="btn btn-secondary">
                        <i class="fas fa-redo"></i> Actualiser
                    </button>
                </div>
            </div>

            <!-- Onglets des cat√©gories -->
            <div class="category-tabs">
                <button class="category-tab active" data-category="all">
                    <i class="fas fa-th-list"></i> Tous les articles
                </button>
                <button class="category-tab" data-category="√âducation mode & industrie">
                    <i class="fas fa-industry"></i> Mode & Industrie
                </button>
                <button class="category-tab" data-category="√âducation pour cr√©ateurs & marques">
                    <i class="fas fa-user-tie"></i> Cr√©ateurs & Marques
                </button>
                <button class="category-tab" data-category="Culture & histoire de la mode">
                    <i class="fas fa-landmark"></i> Culture & Histoire
                </button>
            </div>

            <!-- Grille des articles -->
            <div id="articlesGrid" class="articles-grid">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Chargement des articles...</p>
                </div>
            </div>
        </div>

        <!-- Modal pour cr√©er/modifier un article -->
        <div id="articleModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Nouvel article</h2>
                    <button class="close-modal" id="closeArticleModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="articleForm">
                        <input type="hidden" id="articleId">
                        
                        <div class="form-group">
                            <label for="title"><i class="fas fa-heading"></i> Titre de l'article</label>
                            <input type="text" id="title" required placeholder="Entrez le titre de l'article">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="category"><i class="fas fa-tag"></i> Cat√©gorie</label>
                                <select id="category" required>
                                    <option value="">S√©lectionnez une cat√©gorie</option>
                                    <option value="√âducation mode & industrie">√âducation mode & industrie</option>
                                    <option value="√âducation pour cr√©ateurs & marques">√âducation pour cr√©ateurs & marques</option>
                                    <option value="Culture & histoire de la mode">Culture & histoire de la mode</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="read_time"><i class="fas fa-clock"></i> Temps de lecture (minutes)</label>
                                <input type="number" id="read_time" min="1" max="60" value="5" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="excerpt"><i class="fas fa-align-left"></i> Extrait (court r√©sum√©)</label>
                            <textarea id="excerpt" rows="3" placeholder="R√©sum√© court de l'article (affich√© dans la liste)"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="content"><i class="fas fa-edit"></i> Contenu de l'article</label>
                            <textarea id="content" rows="15" required placeholder="√âcrivez le contenu de l'article ici..."></textarea>
                            <small class="instructions">
                                <strong>Conseils de formatage :</strong><br>
                                - Utilisez des paragraphes s√©par√©s par des lignes vides<br>
                                - Pour les titres : # Titre principal, ## Sous-titre<br>
                                - Pour les citations : > Texte de citation<br>
                                - Pour les listes : - √©l√©ment 1, - √©l√©ment 2<br>
                                - Pour les listes num√©rot√©es : 1. Premier, 2. Deuxi√®me
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="tags"><i class="fas fa-tags"></i> Tags (s√©par√©s par des virgules)</label>
                            <input type="text" id="tags" placeholder="marketing, branding, mode durable, etc.">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="status"><i class="fas fa-circle"></i> Statut</label>
                                <select id="status" required>
                                    <option value="draft">Brouillon</option>
                                    <option value="pending">En attente</option>
                                    <option value="published">Publi√©</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="featured"><i class="fas fa-star"></i> Article mis en avant</label>
                                <select id="featured">
                                    <option value="false">Non</option>
                                    <option value="true">Oui</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelArticle">Annuler</button>
                            <button type="submit" class="btn btn-primary" id="saveArticle">
                                <i class="fas fa-save"></i> Enregistrer l'article
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configuration Supabase - D√©clar√©e une seule fois
        const supabaseUrl = 'https://kfptsbpriihydidnfzhj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmcHRzYnByaWloeWRpZG5memhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNjgxODIsImV4cCI6MjA4MTY0NDE4Mn0.R4AS9kj-o3Zw0OeOTAojMeZfjPtkOZiW0jM367Fmrkk';
        
        // Variables globales - Modifier pour √©viter la red√©claration
        let supabaseClient = null;  // Chang√© de 'supabase' √† 'supabaseClient'
        let allArticles = [];
        let currentFilter = 'all';

        // Fonction principale d'initialisation
        function initEducationalSpace() {
            console.log('üöÄ Initialisation de l\'espace √©ducatif...');
            
            // V√©rifier l'acc√®s admin
            if (!checkAdminAccess()) {
                return;
            }
            
            // Initialiser Supabase
            initSupabase();
            
            // Configurer les √©v√©nements imm√©diatement
            setupEventListeners();
            
            // Charger les articles
            loadArticles();
        }

        function checkAdminAccess() {
            const adminLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
            const isAdmin = sessionStorage.getItem('isAdmin') === 'true';
            
            if (!adminLoggedIn && !isAdmin) {
                alert('Acc√®s non autoris√©. Redirection vers la page admin.');
                window.location.href = 'admin.html';
                return false;
            }
            return true;
        }

        function initSupabase() {
            try {
                supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
                console.log('‚úÖ Supabase initialis√©');
                return true;
            } catch (error) {
                console.error('‚ùå Erreur initialisation Supabase:', error);
                return false;
            }
        }

        async function loadArticles() {
            try {
                console.log('üìö Chargement des articles...');
                
                if (!supabaseClient) {
                    console.error('‚ùå Supabase non initialis√©');
                    showNotification('Erreur de connexion √† la base de donn√©es', 'error');
                    return;
                }

                const { data: articles, error } = await supabaseClient
                    .from('educational_articles')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allArticles = articles || [];
                console.log(`‚úÖ ${allArticles.length} articles charg√©s`);
                
                updateStatistics(allArticles);
                displayArticles(allArticles);
                
            } catch (error) {
                console.error('‚ùå Erreur chargement articles:', error);
                showNotification('Erreur lors du chargement des articles: ' + error.message, 'error');
                showErrorState();
            }
        }

        function updateStatistics(articles) {
            const totalArticles = articles.length;
            const publishedArticles = articles.filter(a => a.status === 'published').length;
            const draftArticles = articles.filter(a => a.status === 'draft').length;
            const totalViews = articles.reduce((sum, article) => sum + (article.views || 0), 0);

            const totalElement = document.getElementById('totalArticlesCount');
            const publishedElement = document.getElementById('publishedArticlesCount');
            const draftElement = document.getElementById('draftArticlesCount');
            const viewsElement = document.getElementById('totalViewsCount');
            
            if (totalElement) totalElement.textContent = totalArticles;
            if (publishedElement) publishedElement.textContent = publishedArticles;
            if (draftElement) draftElement.textContent = draftArticles;
            if (viewsElement) viewsElement.textContent = totalViews;
        }

        function displayArticles(articles) {
            const grid = document.getElementById('articlesGrid');
            if (!grid) {
                console.error('‚ùå Grille d\'articles non trouv√©e');
                return;
            }

            let filteredArticles = [...articles];
            
            // Filtre par onglets
            if (currentFilter !== 'all') {
                filteredArticles = filteredArticles.filter(article => article.category === currentFilter);
            }
            
            // Filtre recherche
            const searchInput = document.getElementById('searchArticles');
            if (searchInput && searchInput.value) {
                const searchTerm = searchInput.value.toLowerCase();
                filteredArticles = filteredArticles.filter(article => 
                    (article.title && article.title.toLowerCase().includes(searchTerm)) ||
                    (article.excerpt && article.excerpt.toLowerCase().includes(searchTerm)) ||
                    (article.content && article.content.toLowerCase().includes(searchTerm)) ||
                    (article.tags && article.tags.toLowerCase().includes(searchTerm))
                );
            }
            
            // Filtre cat√©gorie
            const categorySelect = document.getElementById('filterCategory');
            if (categorySelect && categorySelect.value) {
                filteredArticles = filteredArticles.filter(article => article.category === categorySelect.value);
            }
            
            // Filtre statut
            const statusSelect = document.getElementById('filterStatus');
            if (statusSelect && statusSelect.value) {
                filteredArticles = filteredArticles.filter(article => article.status === statusSelect.value);
            }

            if (filteredArticles.length === 0) {
                grid.innerHTML = `
                    <div class="empty-articles">
                        <i class="fas fa-newspaper"></i>
                        <h3>Aucun article trouv√©</h3>
                        <p>${articles.length === 0 ? 'Cr√©ez votre premier article !' : 'Aucun article ne correspond aux filtres'}</p>
                    </div>
                `;
                return;
            }

            // G√©n√©rer les cartes d'article
            grid.innerHTML = filteredArticles.map(article => {
                const statusClass = `status-${article.status}`;
                const statusLabel = getStatusLabel(article.status);
                const excerpt = article.excerpt || (article.content ? article.content.substring(0, 150) : '') + '...';
                const readTime = article.read_time || 5;
                const views = article.views || 0;
                const createdDate = formatDate(article.created_at);
                const isPublished = article.status === 'published';
                
                return `
                <div class="article-management-card">
                    <div class="article-status ${statusClass}">
                        ${statusLabel}
                    </div>
                    
                    <h3 class="article-title">
                        ${article.featured ? '<i class="fas fa-star" style="color: var(--warning);"></i>' : ''}
                        ${article.title || 'Sans titre'}
                    </h3>
                    
                    <span class="article-category">${article.category || 'Non cat√©goris√©'}</span>
                    
                    <p class="article-excerpt">${excerpt}</p>
                    
                    <div class="article-meta">
                        <div>
                            <span><i class="fas fa-clock"></i> ${readTime} min</span>
                            <span style="margin-left: 15px;"><i class="fas fa-eye"></i> ${views} vues</span>
                        </div>
                        <div>
                            <small>${createdDate}</small>
                        </div>
                    </div>
                    
                    <div class="article-actions">
                        <button class="btn btn-sm btn-edit" data-id="${article.id}">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                        <button class="btn btn-sm ${isPublished ? 'btn-secondary' : 'btn-success'} btn-status" 
                                data-id="${article.id}" 
                                data-status="${article.status}">
                            ${isPublished ? '<i class="fas fa-eye-slash"></i> D√©publier' : '<i class="fas fa-eye"></i> Publier'}
                        </button>
                        <button class="btn btn-sm btn-danger btn-delete" data-id="${article.id}">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                </div>
                `;
            }).join('');
            
            // Attacher les √©v√©nements aux boutons g√©n√©r√©s
            attachArticleButtonsEvents();
        }

        function getStatusLabel(status) {
            const labels = {
                'published': 'Publi√©',
                'draft': 'Brouillon',
                'pending': 'En attente'
            };
            return labels[status] || status;
        }

        function formatDate(dateString) {
            if (!dateString) return 'Date inconnue';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('fr-FR');
            } catch (error) {
                return 'Date invalide';
            }
        }

        function setupEventListeners() {
            console.log('üîß Configuration des √©v√©nements...');
            
            // Bouton Nouvel article
            const addBtn = document.getElementById('addArticleBtn');
            if (addBtn) {
                addBtn.addEventListener('click', function() {
                    console.log('‚ûï Bouton Nouvel article cliqu√©');
                    openArticleModal();
                });
            } else {
                console.error('‚ùå Bouton "Nouvel article" non trouv√©');
            }
            
            // Bouton Actualiser
            const refreshBtn = document.getElementById('refreshArticles');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    console.log('üîÑ Bouton Actualiser cliqu√©');
                    loadArticles();
                    showNotification('Liste actualis√©e', 'success');
                });
            } else {
                console.error('‚ùå Bouton "Actualiser" non trouv√©');
            }
            
            // Bouton Effacer les filtres
            const clearBtn = document.getElementById('clearFilters');
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    console.log('üßπ Bouton Effacer filtres cliqu√©');
                    document.getElementById('searchArticles').value = '';
                    document.getElementById('filterCategory').value = '';
                    document.getElementById('filterStatus').value = '';
                    currentFilter = 'all';
                    updateCategoryTabs();
                    displayArticles(allArticles);
                    showNotification('Filtres effac√©s', 'info');
                });
            } else {
                console.error('‚ùå Bouton "Effacer les filtres" non trouv√©');
            }
            
            // Filtre recherche
            const searchInput = document.getElementById('searchArticles');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    displayArticles(allArticles);
                });
            }
            
            // Filtre cat√©gorie
            const categorySelect = document.getElementById('filterCategory');
            if (categorySelect) {
                categorySelect.addEventListener('change', function() {
                    displayArticles(allArticles);
                });
            }
            
            // Filtre statut
            const statusSelect = document.getElementById('filterStatus');
            if (statusSelect) {
                statusSelect.addEventListener('change', function() {
                    displayArticles(allArticles);
                });
            }
            
            // Onglets de cat√©gorie
            const categoryTabs = document.querySelectorAll('.category-tab');
            if (categoryTabs.length > 0) {
                categoryTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        console.log('üìä Onglet cliqu√©:', this.dataset.category);
                        currentFilter = this.dataset.category;
                        
                        // Mettre √† jour l'onglet actif
                        categoryTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Afficher les articles filtr√©s
                        displayArticles(allArticles);
                    });
                });
            } else {
                console.error('‚ùå Onglets de cat√©gorie non trouv√©s');
            }
            
            // Modal - Fermer
            const closeModalBtn = document.getElementById('closeArticleModal');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', function() {
                    document.getElementById('articleModal').classList.remove('active');
                });
            }
            
            // Modal - Annuler
            const cancelBtn = document.getElementById('cancelArticle');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    document.getElementById('articleModal').classList.remove('active');
                });
            }
            
            // Modal - Clic en dehors
            const modal = document.getElementById('articleModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            }
            
            // Formulaire
            const articleForm = document.getElementById('articleForm');
            if (articleForm) {
                articleForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await saveArticle();
                });
            }
            
            // D√©connexion
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    sessionStorage.removeItem('adminLoggedIn');
                    sessionStorage.removeItem('isAdmin');
                    window.location.href = 'admin.html';
                });
            }
            
            console.log('‚úÖ Tous les √©v√©nements configur√©s');
        }

        function attachArticleButtonsEvents() {
            // Boutons Modifier
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const articleId = parseInt(this.getAttribute('data-id'));
                    console.log('‚úèÔ∏è Modification article ID:', articleId);
                    openArticleModal(articleId);
                });
            });
            
            // Boutons Publier/D√©publier
            document.querySelectorAll('.btn-status').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const articleId = parseInt(this.getAttribute('data-id'));
                    const currentStatus = this.getAttribute('data-status');
                    const newStatus = currentStatus === 'published' ? 'draft' : 'published';
                    
                    console.log('üîÑ Changement statut article ID:', articleId, currentStatus, '‚Üí', newStatus);
                    await toggleArticleStatus(articleId, newStatus);
                });
            });
            
            // Boutons Supprimer
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const articleId = parseInt(this.getAttribute('data-id'));
                    console.log('üóëÔ∏è Suppression article ID:', articleId);
                    await deleteArticle(articleId);
                });
            });
        }

        function updateCategoryTabs() {
            const categoryTabs = document.querySelectorAll('.category-tab');
            categoryTabs.forEach(tab => {
                if (tab.dataset.category === currentFilter) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
        }

        function openArticleModal(articleId = null) {
            console.log('üìù Ouverture modal article ID:', articleId);
            const modal = document.getElementById('articleModal');
            const form = document.getElementById('articleForm');
            const title = document.getElementById('modalTitle');
            
            if (articleId) {
                // Mode √©dition
                title.textContent = 'Modifier l\'article';
                const article = allArticles.find(a => a.id === articleId);
                
                if (article) {
                    document.getElementById('articleId').value = article.id;
                    document.getElementById('title').value = article.title;
                    document.getElementById('category').value = article.category;
                    document.getElementById('read_time').value = article.read_time || 5;
                    document.getElementById('excerpt').value = article.excerpt || '';
                    document.getElementById('content').value = article.content;
                    document.getElementById('tags').value = article.tags || '';
                    document.getElementById('status').value = article.status;
                    document.getElementById('featured').value = article.featured ? 'true' : 'false';
                }
            } else {
                // Mode cr√©ation
                title.textContent = 'Nouvel article';
                form.reset();
                document.getElementById('articleId').value = '';
                document.getElementById('read_time').value = 5;
                document.getElementById('status').value = 'draft';
                document.getElementById('featured').value = 'false';
            }
            
            modal.classList.add('active');
        }

        async function saveArticle() {
            const articleId = document.getElementById('articleId').value;
            const isEdit = !!articleId;
            
            // Validation
            const title = document.getElementById('title').value.trim();
            const category = document.getElementById('category').value;
            const content = document.getElementById('content').value.trim();
            
            if (!title) {
                showNotification('Le titre est requis', 'error');
                return;
            }
            
            if (!category) {
                showNotification('La cat√©gorie est requise', 'error');
                return;
            }
            
            if (!content) {
                showNotification('Le contenu est requis', 'error');
                return;
            }
            
            const articleData = {
                title: title,
                category: category,
                read_time: parseInt(document.getElementById('read_time').value) || 5,
                excerpt: document.getElementById('excerpt').value.trim(),
                content: content,
                tags: document.getElementById('tags').value.trim(),
                status: document.getElementById('status').value,
                featured: document.getElementById('featured').value === 'true',
                updated_at: new Date().toISOString()
            };
            
            if (!isEdit) {
                articleData.created_at = new Date().toISOString();
                articleData.views = 0;
            }
            
            try {
                let error;
                
                if (isEdit) {
                    const { error: updateError } = await supabaseClient
                        .from('educational_articles')
                        .update(articleData)
                        .eq('id', articleId);
                    error = updateError;
                } else {
                    const { error: insertError } = await supabaseClient
                        .from('educational_articles')
                        .insert([articleData]);
                    error = insertError;
                }
                
                if (error) throw error;
                
                showNotification(`Article ${isEdit ? 'modifi√©' : 'cr√©√©'} avec succ√®s`, 'success');
                
                document.getElementById('articleModal').classList.remove('active');
                await loadArticles();
                
            } catch (error) {
                console.error('‚ùå Erreur sauvegarde article:', error);
                showNotification('Erreur lors de la sauvegarde: ' + error.message, 'error');
            }
        }

        async function toggleArticleStatus(articleId, newStatus) {
            if (!confirm(`√ätes-vous s√ªr de vouloir ${newStatus === 'published' ? 'publier' : 'd√©publier'} cet article ?`)) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('educational_articles')
                    .update({ 
                        status: newStatus,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', articleId);
                
                if (error) throw error;
                
                showNotification(`Article ${newStatus === 'published' ? 'publi√©' : 'd√©publi√©'}`, 'success');
                await loadArticles();
                
            } catch (error) {
                console.error('‚ùå Erreur changement statut:', error);
                showNotification('Erreur lors du changement de statut', 'error');
            }
        }

        async function deleteArticle(articleId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet article ? Cette action est irr√©versible.')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('educational_articles')
                    .delete()
                    .eq('id', articleId);
                
                if (error) throw error;
                
                showNotification('Article supprim√© avec succ√®s', 'success');
                await loadArticles();
                
            } catch (error) {
                console.error('‚ùå Erreur suppression article:', error);
                showNotification('Erreur lors de la suppression', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            // Supprimer anciennes notifications
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(n => n.remove());
            
            // Cr√©er notification
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };
            
            notification.innerHTML = `
                <i class="fas fa-${icons[type] || 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                color: #333;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 10000;
                border-left: 4px solid ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#17a2b8'};
                animation: slideIn 0.3s ease;
            `;
            
            // Style pour l'animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showErrorState() {
            const grid = document.getElementById('articlesGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="empty-articles">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger les articles. V√©rifiez votre connexion.</p>
                        <button class="btn btn-primary" id="retryBtn">
                            <i class="fas fa-redo"></i> R√©essayer
                        </button>
                    </div>
                `;
                
                // Ajouter √©v√©nement au bouton R√©essayer
                const retryBtn = document.getElementById('retryBtn');
                if (retryBtn) {
                    retryBtn.addEventListener('click', function() {
                        loadArticles();
                    });
                }
            }
        }

        // D√©marrer l'application quand la page est charg√©e
        document.addEventListener('DOMContentLoaded', initEducationalSpace);
    </script>
</body>
</html>
